/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __decorateClass = (decorators, target, key, kind) => {
  var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc(target, key) : target;
  for (var i = decorators.length - 1, decorator; i >= 0; i--)
    if (decorator = decorators[i])
      result = (kind ? decorator(target, key, result) : decorator(result)) || result;
  if (kind && result)
    __defProp(target, key, result);
  return result;
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => LovelyMindmap
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// src/tool/index.ts
function debounce(delay = 100) {
  let lastTime = 0;
  let timer;
  return function(target, propertyKey, descriptor) {
    const originalMethod = descriptor.value;
    descriptor.value = function(...args) {
      const now = Date.now();
      clearTimeout(timer);
      if (now - lastTime < delay) {
        return;
      }
      timer = setTimeout(() => {
        originalMethod.apply(this, args);
        lastTime = 0;
      }, delay);
      lastTime = now;
    };
    return descriptor;
  };
}
function calcDistance(a, b) {
  return Math.sqrt(
    (a[0] - b[0]) ** 2 + (a[1] - b[1]) ** 2
  );
}
function findClosestNodeByBbox(pos, nodes) {
  return nodes.reduce((prev, cur, idx) => {
    const a = [cur.bbox.minX, cur.bbox.minY];
    const b = [cur.bbox.maxX, cur.bbox.minY];
    const c = [cur.bbox.minX, cur.bbox.maxY];
    const d = [cur.bbox.maxX, cur.bbox.maxY];
    const distance = Math.min(
      calcDistance(pos, a),
      calcDistance(pos, b),
      calcDistance(pos, c),
      calcDistance(pos, d)
    );
    if (idx === 0) {
      return {
        node: cur,
        distance
      };
    }
    return distance < prev.distance ? { node: cur, distance } : prev;
  }, {
    node: {},
    distance: 0
  });
}
function uuid() {
  const first = Math.floor(Math.random() * 9 + 1);
  const rest = String(Math.random()).slice(2, 10);
  const random9 = first + rest;
  return string10To64(Date.now()) + string10To64(random9);
}
function string10To64(str) {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
  const radix = chars.length;
  let num = typeof str === "string" ? parseInt(str) : str;
  const res = [];
  do {
    const mod = num % radix;
    res.push(chars[mod]);
    num = (num - mod) / radix;
  } while (num > 0);
  return res.join("");
}

// node_modules/autobind-decorator/lib/esm/index.js
function _typeof(obj) {
  if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
    _typeof = function _typeof2(obj2) {
      return typeof obj2;
    };
  } else {
    _typeof = function _typeof2(obj2) {
      return obj2 && typeof Symbol === "function" && obj2.constructor === Symbol && obj2 !== Symbol.prototype ? "symbol" : typeof obj2;
    };
  }
  return _typeof(obj);
}
function boundMethod(target, key, descriptor) {
  var fn = descriptor.value;
  if (typeof fn !== "function") {
    throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(_typeof(fn)));
  }
  var definingProperty = false;
  return {
    configurable: true,
    get: function get() {
      if (definingProperty || this === target.prototype || this.hasOwnProperty(key) || typeof fn !== "function") {
        return fn;
      }
      var boundFn = fn.bind(this);
      definingProperty = true;
      Object.defineProperty(this, key, {
        configurable: true,
        get: function get2() {
          return boundFn;
        },
        set: function set(value) {
          fn = value;
          delete this[key];
        }
      });
      definingProperty = false;
      return boundFn;
    },
    set: function set(value) {
      fn = value;
    }
  };
}
function boundClass(target) {
  var keys;
  if (typeof Reflect !== "undefined" && typeof Reflect.ownKeys === "function") {
    keys = Reflect.ownKeys(target.prototype);
  } else {
    keys = Object.getOwnPropertyNames(target.prototype);
    if (typeof Object.getOwnPropertySymbols === "function") {
      keys = keys.concat(Object.getOwnPropertySymbols(target.prototype));
    }
  }
  keys.forEach(function(key) {
    if (key === "constructor") {
      return;
    }
    var descriptor = Object.getOwnPropertyDescriptor(target.prototype, key);
    if (typeof descriptor.value === "function") {
      Object.defineProperty(target.prototype, key, boundMethod(target, key, descriptor));
    }
  });
  return target;
}
function autobind() {
  if (arguments.length === 1) {
    return boundClass.apply(void 0, arguments);
  }
  return boundMethod.apply(void 0, arguments);
}

// src/module/node.ts
var Node = class {
  constructor(main) {
    this.main = main;
  }
  getNavigationNode() {
    const node = this.getSingleSelection();
    if (!node || !node.isFocused || node.isEditing)
      return null;
    return node;
  }
  getCreationNode() {
    const node = this.getSingleSelection();
    if (!node || !node.isFocused || !node.isEditing)
      return null;
    return node;
  }
  getSelection() {
    return this.main.canvas.selection;
  }
  getSingleSelection() {
    const selections = this.main.canvas.selection;
    if (selections.size === 0 || selections.size > 1) {
      return null;
    }
    return selections.values().next().value;
  }
  getFromNodes(node) {
    const fromNodeFilter = (edge) => edge.to.node.id === node.id;
    return this.main.canvas.getEdgesForNode(node).filter(fromNodeFilter).map((edge) => edge.from.node);
  }
  getToNodes(node) {
    const toNodeFilter = (edge) => edge.from.node.id === node.id;
    return this.main.canvas.getEdgesForNode(node).filter(toNodeFilter).map((edge) => edge.to.node);
  }
  getSibNodes(target) {
    const fromNodes = this.getFromNodes(target);
    const toNodes = this.getToNodes(fromNodes[0]);
    return toNodes.filter((node) => node.id !== target.id);
  }
  createChildren() {
    const selection = this.getNavigationNode();
    if (!selection)
      return;
    const {
      x,
      y,
      width,
      height
    } = selection;
    const rightSideNodeFilter = (node) => {
      var _a, _b, _c;
      return ((_a = node == null ? void 0 : node.to) == null ? void 0 : _a.side) === "left" && selection.id !== ((_c = (_b = node == null ? void 0 : node.to) == null ? void 0 : _b.node) == null ? void 0 : _c.id);
    };
    const sibNodes = this.main.canvas.getEdgesForNode(selection).filter(rightSideNodeFilter).map((node) => node.to.node);
    const nextNodeY = Math.max(...sibNodes.map((node) => node.y)) + this.main.setting.EPSILON;
    const childNode = this.main.canvas.createTextNode({
      pos: {
        x: x + width + 200,
        y: nextNodeY
      },
      size: {
        height,
        width
      },
      text: "",
      focus: false,
      save: true
    });
    const data = this.main.canvas.getData();
    this.main.canvas.importData({
      "edges": [
        ...data.edges,
        {
          "id": uuid(),
          "fromNode": selection.id,
          "fromSide": "right",
          "toNode": childNode.id,
          "toSide": "left"
        }
      ],
      "nodes": data.nodes
    });
    this.main.layout.useSide(selection, sibNodes.concat(childNode));
    this.main.view.zoomToNode(childNode);
  }
  createSibNode(_, context) {
    const selection = this.getNavigationNode();
    if (!selection)
      return;
    const {
      x,
      y,
      width,
      height
    } = selection;
    const { EPSILON } = this.main.setting;
    const isPressedShift = context.modifiers === "Shift";
    const fromNode = this.main.node.getFromNodes(selection)[0];
    const toNodes = this.main.node.getToNodes(fromNode);
    const willInsertedNode = this.main.canvas.createTextNode({
      pos: {
        x,
        y: isPressedShift ? y - EPSILON : y + EPSILON
      },
      size: {
        height,
        width
      },
      text: "",
      focus: false,
      save: true
    });
    const data = this.main.canvas.getData();
    this.main.canvas.importData({
      "edges": [
        ...data.edges,
        {
          "id": uuid(),
          "fromNode": fromNode.id,
          "fromSide": "right",
          "toNode": willInsertedNode.id,
          "toSide": "left"
        }
      ],
      "nodes": data.nodes
    });
    this.main.layout.useSide(fromNode, toNodes.concat(willInsertedNode));
    this.main.view.zoomToNode(willInsertedNode);
  }
};
__decorateClass([
  debounce()
], Node.prototype, "createChildren", 1);
__decorateClass([
  debounce()
], Node.prototype, "createSibNode", 1);
Node = __decorateClass([
  autobind
], Node);

// src/module/keymap.ts
var Keymap = class {
  constructor(main) {
    this.hotkeys = [];
    this.main = main;
    this.node = main.node;
  }
  async help() {
    if (this.main.view.isCreating())
      return;
    console.log("this:\n", this);
    console.log("app:\n", this.main.app);
    console.log("canvas:\n", this.main.canvas);
    console.log("selections:\n", this.main.canvas.selection.values().next());
  }
  nodeNavigation(_, context) {
    const { key } = context;
    const selection = this.node.getSingleSelection();
    if (!selection || selection.isEditing) {
      return;
    }
    const { OFFSET_WEIGHT } = this.main.setting;
    const data = this.main.canvas.getViewportNodes();
    const offsetX = (a, b) => Math.abs(b.x - a.x);
    const offsetY = (a, b) => Math.abs(b.y - a.y);
    const endpointOffset = (a, b) => Math.min(
      Math.abs(b.y - a.y + 2 / a.height),
      Math.abs(b.y + b.height - a.y - 2 / a.height),
      Math.abs(b.x - a.x + 2 / a.width),
      Math.abs(b.x + b.width - a.x + 2 / a.width)
    );
    const calcDistance2 = (a, b) => key === "ArrowLeft" || key === "ArrowRight" ? offsetX(a, b) + endpointOffset(a, b) ** OFFSET_WEIGHT : offsetY(a, b) + endpointOffset(a, b) ** OFFSET_WEIGHT;
    const isSameDirection = (node) => {
      const notSelf = node.id !== selection.id;
      const strategies = {
        ArrowRight: notSelf && node.x > selection.x + selection.width,
        ArrowLeft: notSelf && node.x + node.width < selection.x,
        ArrowUp: notSelf && node.y + node.height < selection.y,
        ArrowDown: notSelf && node.y > selection.y + selection.height
      };
      return strategies[key];
    };
    const midpoints = data.filter(isSameDirection).map((node) => ({
      node,
      offsetX: offsetX(selection, node),
      offsetY: offsetY(selection, node),
      endpointOffset: endpointOffset(selection, node),
      distance: calcDistance2(selection, node)
    })).sort((a, b) => a.distance - b.distance);
    if (midpoints.length > 0) {
      this.main.view.zoomToNode(midpoints[0].node);
    }
  }
  blurNode() {
    if (this.main.view.isCreating()) {
      this.main.view.creation2Navigation();
      return;
    }
    if (this.main.view.isNavigating()) {
      this.main.view.useTouch();
      return;
    }
  }
  focusNode() {
    if (this.main.view.isTouching()) {
      this.main.view.touch2Navigation();
      return;
    }
    const navigationNode = this.main.node.getNavigationNode();
    if (!!navigationNode) {
      this.main.view.useCreation(navigationNode);
      return;
    }
  }
  register(modifiers, key, func) {
    return this.main.app.scope.register(modifiers, key, func);
  }
  registerAll() {
    this.hotkeys.push(
      this.register([], "f", this.focusNode),
      this.register(["Meta"], "Escape", this.blurNode),
      this.register([], "Tab", this.main.node.createChildren),
      this.register([], "enter", this.main.node.createSibNode),
      this.register(["Shift"], "enter", this.main.node.createSibNode),
      this.register(["Alt"], "arrowLeft", this.nodeNavigation),
      this.register(["Alt"], "arrowRight", this.nodeNavigation),
      this.register(["Alt"], "arrowUp", this.nodeNavigation),
      this.register(["Alt"], "arrowDown", this.nodeNavigation)
      // this.register([], 'h', this.help)
    );
  }
  unregisterAll() {
    this.hotkeys.forEach((key) => this.main.app.scope.unregister(key));
  }
};
__decorateClass([
  debounce()
], Keymap.prototype, "help", 1);
Keymap = __decorateClass([
  autobind
], Keymap);

// src/module/view.ts
var View = class {
  constructor(main) {
    this.main = main;
  }
  isTouching() {
    return this.main.node.getSelection().size === 0;
  }
  isNavigating() {
    const node = this.main.node.getSingleSelection();
    if (!node)
      return false;
    return node.isFocused && !node.isEditing;
  }
  isCreating() {
    const node = this.main.node.getSingleSelection();
    if (!node)
      return false;
    return node.isFocused && node.isEditing;
  }
  useTouch() {
    this.main.canvas.deselectAll();
  }
  useCreation(node) {
    setTimeout(
      () => node.startEditing(),
      this.main.setting.MACRO_TASK_DELAY
    );
  }
  creation2Navigation() {
    const selection = this.main.node.getSingleSelection();
    if (!selection || !this.isCreating())
      return;
    selection.blur();
    selection.focus();
  }
  touch2Navigation() {
    const viewportBBox = this.main.canvas.getViewportBBox();
    const centerPoint = [
      (viewportBBox.minX + viewportBBox.maxX) / 2,
      (viewportBBox.minY + viewportBBox.maxY) / 2
    ];
    const viewportNodes = this.main.canvas.getViewportNodes();
    const res = findClosestNodeByBbox(centerPoint, viewportNodes);
    this.zoomToNode(res.node);
  }
  zoomToNode(node) {
    this.main.canvas.selectOnly(node);
    this.main.canvas.zoomToSelection();
    if (this.main.config.autoFocus) {
      this.useCreation(node);
    }
  }
};

// src/module/setting.ts
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  autoFocus: false
};
var Setting = class extends import_obsidian.PluginSettingTab {
  constructor(main) {
    super(main.app, main);
    this.ROW_GAP = 20;
    this.COLUMN_GAP = 200;
    this.autoFocus = false;
    this.MACRO_TASK_DELAY = 50;
    this.EPSILON = 1;
    this.OFFSET_WEIGHT = 1.1;
    this.main = main;
    console.log("setting");
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h3", { text: "\u{1F6A7}\u{1F6A7}\u{1F6A7}" });
    containerEl.createEl("h3", { text: "The page is under development" });
    containerEl.createEl("h3", { text: "Most settings are out-of-the-box" });
    this.addAutoFocus();
  }
  addAutoFocus() {
    new import_obsidian.Setting(this.containerEl).setName("autoFocus").setDesc("auto focus node when create new node").addToggle(
      (component) => component.setValue(this.main.config.autoFocus).onChange(async (open) => {
        this.main.config.autoFocus = open;
        await this.main.saveData(this.main.config);
      })
    );
  }
  async loadSettings() {
    this.main.config = { ...DEFAULT_SETTINGS, ...await this.main.loadData() };
  }
};

// src/module/layout.ts
var Layout = class {
  constructor(main) {
    this.main = main;
  }
  useSide(parent, child) {
    const { ROW_GAP, COLUMN_GAP } = this.main.setting;
    const bbox = child.reduce((prev, node, idx) => {
      return idx > 0 ? {
        height: prev.height + node.height + ROW_GAP,
        heightNodes: prev.heightNodes.concat(node.height)
      } : {
        height: prev.height + node.height,
        heightNodes: prev.heightNodes.concat(node.height)
      };
    }, {
      height: 0,
      heightNodes: []
    });
    const top = parent.y + parent.height * 0.5 - bbox.height * 0.5;
    const getSum = (arr) => arr.reduce((sum, cur) => sum + cur, 0);
    child.sort((a, b) => a.y - b.y).forEach((node, i) => {
      node.moveTo({
        x: parent.width + parent.x + COLUMN_GAP,
        y: top + ROW_GAP * i + getSum(bbox.heightNodes.slice(0, i))
      });
    });
  }
  useSurround() {
  }
};

// src/main.ts
var LovelyMindmap = class extends import_obsidian2.Plugin {
  constructor(app2, manifest) {
    super(app2, manifest);
    this.canvas = null;
    this.intervalTimer = /* @__PURE__ */ new Map();
    this.node = new Node(this);
    this.keymap = new Keymap(this);
    this.view = new View(this);
    this.setting = new Setting(this);
    this.layout = new Layout(this);
  }
  createCanvasInstance() {
    const timer = setInterval(() => {
      var _a, _b;
      this.canvas = (_b = (_a = app.workspace.getLeavesOfType("canvas").first()) == null ? void 0 : _a.view) == null ? void 0 : _b.canvas;
      if (!!this.canvas) {
        clearInterval(this.intervalTimer.get("canvas"));
      }
    }, 1e3);
    if (!this.intervalTimer.get("canvas")) {
      this.intervalTimer.set("canvas", timer);
    }
  }
  async onload() {
    await this.setting.loadSettings();
    this.addSettingTab(new Setting(this));
    this.keymap.registerAll();
    this.createCanvasInstance();
  }
  onunload() {
    this.keymap.unregisterAll();
    this.intervalTimer.forEach(clearInterval);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3Rvb2wvaW5kZXgudHMiLCAibm9kZV9tb2R1bGVzL2F1dG9iaW5kLWRlY29yYXRvci9saWIvZXNtL2luZGV4LmpzIiwgInNyYy9tb2R1bGUvbm9kZS50cyIsICJzcmMvbW9kdWxlL2tleW1hcC50cyIsICJzcmMvbW9kdWxlL3ZpZXcudHMiLCAic3JjL21vZHVsZS9zZXR0aW5nLnRzIiwgInNyYy9tb2R1bGUvbGF5b3V0LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQge0FwcCwgUGx1Z2luLCBQbHVnaW5NYW5pZmVzdCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyBhcyBPYnNpZGlhblNldHRpbmcgfSBmcm9tICdvYnNpZGlhbidcbmltcG9ydCB7S2V5bWFwLCBMYXlvdXQsIE5vZGUsIFNldHRpbmcsIFZpZXd9IGZyb20gJy4vbW9kdWxlJ1xuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExvdmVseU1pbmRtYXAgZXh0ZW5kcyBQbHVnaW57XG4gIGNhbnZhczogYW55ID0gbnVsbFxuICBpbnRlcnZhbFRpbWVyID0gbmV3IE1hcCgpXG4gIG5vZGU6IE5vZGVcbiAga2V5bWFwOiBLZXltYXBcbiAgdmlldzogVmlld1xuICBzZXR0aW5nOiBTZXR0aW5nXG4gIGxheW91dDogTGF5b3V0XG4gIC8vIHRvZG86IG1vdmUgdG8gc2V0dGluZ1xuICBjb25maWc6IFJlY29yZDxrZXlvZiBTZXR0aW5nLCBhbnk+XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIG1hbmlmZXN0OiBQbHVnaW5NYW5pZmVzdCkge1xuICAgIHN1cGVyKGFwcCwgbWFuaWZlc3QpXG4gICAgdGhpcy5ub2RlID0gbmV3IE5vZGUodGhpcylcbiAgICB0aGlzLmtleW1hcCA9IG5ldyBLZXltYXAodGhpcylcbiAgICB0aGlzLnZpZXcgPSBuZXcgVmlldyh0aGlzKVxuICAgIHRoaXMuc2V0dGluZyA9IG5ldyBTZXR0aW5nKHRoaXMpXG4gICAgdGhpcy5sYXlvdXQgPSBuZXcgTGF5b3V0KHRoaXMpXG4gIH1cblxuICBjcmVhdGVDYW52YXNJbnN0YW5jZSgpIHtcbiAgICBjb25zdCB0aW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHRoaXMuY2FudmFzID0gYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ2NhbnZhcycpLmZpcnN0KCk/LnZpZXc/LmNhbnZhc1xuICAgICAgaWYgKCEhdGhpcy5jYW52YXMpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsVGltZXIuZ2V0KCdjYW52YXMnKSlcbiAgICAgIH1cbiAgICB9LCAxMDAwKVxuXG4gICAgaWYgKCF0aGlzLmludGVydmFsVGltZXIuZ2V0KCdjYW52YXMnKSkge1xuICAgICAgdGhpcy5pbnRlcnZhbFRpbWVyLnNldCgnY2FudmFzJywgdGltZXIpXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGF3YWl0IHRoaXMuc2V0dGluZy5sb2FkU2V0dGluZ3MoKVxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2V0dGluZyh0aGlzKSlcbiAgICB0aGlzLmtleW1hcC5yZWdpc3RlckFsbCgpXG4gICAgdGhpcy5jcmVhdGVDYW52YXNJbnN0YW5jZSgpXG4gIH1cblxuICBvbnVubG9hZCgpIHtcbiAgICB0aGlzLmtleW1hcC51bnJlZ2lzdGVyQWxsKClcbiAgICB0aGlzLmludGVydmFsVGltZXIuZm9yRWFjaChjbGVhckludGVydmFsKVxuICB9XG59XG4iLCAiZnVuY3Rpb24gZGVib3VuY2UoZGVsYXk6IG51bWJlciA9IDEwMCk6IE1ldGhvZERlY29yYXRvciB7XG4gIGxldCBsYXN0VGltZSA9IDBcbiAgbGV0IHRpbWVyOiBOb2RlSlMuVGltZW91dFxuXG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikge1xuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZVxuXG4gICAgZGVzY3JpcHRvci52YWx1ZSA9IGZ1bmN0aW9uICguLi5hcmdzOiBhbnlbXSkge1xuICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKVxuXG4gICAgICBpZiAoKG5vdyAtIGxhc3RUaW1lKSA8IGRlbGF5KSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBvcmlnaW5hbE1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKVxuICAgICAgICBsYXN0VGltZSA9IDBcbiAgICAgIH0sIGRlbGF5KVxuXG4gICAgICBsYXN0VGltZSA9IG5vd1xuICAgIH1cblxuICAgIHJldHVybiBkZXNjcmlwdG9yXG4gIH1cbn1cblxuXG5mdW5jdGlvbiBjYWxjRGlzdGFuY2UoYTogTS5Qb3NpdGlvbiwgYjogTS5Qb3NpdGlvbikge1xuICByZXR1cm4gTWF0aC5zcXJ0KFxuICAgIChhWzBdIC0gYlswXSkgKiogMiArXG4gICAgKGFbMV0gLSBiWzFdKSAqKiAyXG4gIClcbn1cblxuZnVuY3Rpb24gZmluZENsb3Nlc3ROb2RlQnlCYm94KHBvczogTS5Qb3NpdGlvbiwgbm9kZXM6IE0uTm9kZVtdKTogeyBub2RlOiBNLk5vZGUsIGRpc3RhbmNlOiBudW1iZXIgfSB7XG4gIHJldHVybiBub2Rlcy5yZWR1Y2UoKHByZXYsIGN1ciwgaWR4KSA9PiB7XG4gICAgY29uc3QgYTogTS5Qb3NpdGlvbiA9IFtjdXIuYmJveC5taW5YLCBjdXIuYmJveC5taW5ZXVxuICAgIGNvbnN0IGI6IE0uUG9zaXRpb24gPSBbY3VyLmJib3gubWF4WCwgY3VyLmJib3gubWluWV1cbiAgICBjb25zdCBjOiBNLlBvc2l0aW9uID0gW2N1ci5iYm94Lm1pblgsIGN1ci5iYm94Lm1heFldXG4gICAgY29uc3QgZDogTS5Qb3NpdGlvbiA9IFtjdXIuYmJveC5tYXhYLCBjdXIuYmJveC5tYXhZXVxuICAgIC8vIHRvZG86IGF0IGxlYXN0IHR3byBvciBtb3JlIHBvaW50IGluIGVhY2ggbm9kZSBjYW4gYmUgaWdub3JlZFxuICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5taW4oXG4gICAgICBjYWxjRGlzdGFuY2UocG9zLCBhKSxcbiAgICAgIGNhbGNEaXN0YW5jZShwb3MsIGIpLFxuICAgICAgY2FsY0Rpc3RhbmNlKHBvcywgYyksXG4gICAgICBjYWxjRGlzdGFuY2UocG9zLCBkKSxcbiAgICApXG5cbiAgICBpZiAoaWR4ID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBub2RlOiBjdXIsXG4gICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZSxcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZGlzdGFuY2UgPCBwcmV2LmRpc3RhbmNlXG4gICAgICA/IHtub2RlOiBjdXIsIGRpc3RhbmNlfVxuICAgICAgOiBwcmV2XG5cbiAgfSwge1xuICAgIG5vZGU6IHt9IGFzIGFueSxcbiAgICBkaXN0YW5jZTogMCxcbiAgfSlcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSA2NC1iaXQgcmFuZG9tIG51bWJlciBvZiBsZW5ndGhzIDEyXG4gKi9cbmZ1bmN0aW9uIHV1aWQoKSB7XG4gIGNvbnN0IGZpcnN0ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOSArIDEpXG4gIGNvbnN0IHJlc3QgPSBTdHJpbmcoTWF0aC5yYW5kb20oKSkuc2xpY2UoMiwgMTApXG4gIGNvbnN0IHJhbmRvbTkgPSBmaXJzdCArIHJlc3RcblxuIHJldHVybiBzdHJpbmcxMFRvNjQoRGF0ZS5ub3coKSkgKyBzdHJpbmcxMFRvNjQocmFuZG9tOSlcbn1cblxuZnVuY3Rpb24gc3RyaW5nMTBUbzY0KHN0cjogbnVtYmVyIHwgc3RyaW5nKSB7XG4gIGNvbnN0IGNoYXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5LV8nXG4gIGNvbnN0IHJhZGl4ID0gY2hhcnMubGVuZ3RoXG4gIGxldCBudW0gPSB0eXBlb2Ygc3RyID09PSAnc3RyaW5nJyA/IHBhcnNlSW50KHN0cikgOiBzdHJcbiAgY29uc3QgcmVzID0gW11cblxuICBkbyB7XG4gICAgY29uc3QgbW9kID0gbnVtICUgcmFkaXhcbiAgICByZXMucHVzaChjaGFyc1ttb2RdKVxuICAgIG51bSA9IChudW0gLSBtb2QpIC8gcmFkaXhcbiAgfSB3aGlsZSAobnVtID4gMClcblxuICByZXR1cm4gcmVzLmpvaW4oJycpXG59XG5cbmV4cG9ydCB7IGRlYm91bmNlLCBjYWxjRGlzdGFuY2UsIGZpbmRDbG9zZXN0Tm9kZUJ5QmJveCwgdXVpZCB9XG4iLCAiZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH1cblxuLyoqXG4gKiBSZXR1cm4gYSBkZXNjcmlwdG9yIHJlbW92aW5nIHRoZSB2YWx1ZSBhbmQgcmV0dXJuaW5nIGEgZ2V0dGVyXG4gKiBUaGUgZ2V0dGVyIHdpbGwgcmV0dXJuIGEgLmJpbmQgdmVyc2lvbiBvZiB0aGUgZnVuY3Rpb25cbiAqIGFuZCBtZW1vaXplIHRoZSByZXN1bHQgYWdhaW5zdCBhIHN5bWJvbCBvbiB0aGUgaW5zdGFuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJvdW5kTWV0aG9kKHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKSB7XG4gIHZhciBmbiA9IGRlc2NyaXB0b3IudmFsdWU7XG5cbiAgaWYgKHR5cGVvZiBmbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJAYm91bmRNZXRob2QgZGVjb3JhdG9yIGNhbiBvbmx5IGJlIGFwcGxpZWQgdG8gbWV0aG9kcyBub3Q6IFwiLmNvbmNhdChfdHlwZW9mKGZuKSkpO1xuICB9IC8vIEluIElFMTEgY2FsbGluZyBPYmplY3QuZGVmaW5lUHJvcGVydHkgaGFzIGEgc2lkZS1lZmZlY3Qgb2YgZXZhbHVhdGluZyB0aGVcbiAgLy8gZ2V0dGVyIGZvciB0aGUgcHJvcGVydHkgd2hpY2ggaXMgYmVpbmcgcmVwbGFjZWQuIFRoaXMgY2F1c2VzIGluZmluaXRlXG4gIC8vIHJlY3Vyc2lvbiBhbmQgYW4gXCJPdXQgb2Ygc3RhY2sgc3BhY2VcIiBlcnJvci5cblxuXG4gIHZhciBkZWZpbmluZ1Byb3BlcnR5ID0gZmFsc2U7XG4gIHJldHVybiB7XG4gICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXByb3RvdHlwZS1idWlsdGluc1xuICAgICAgaWYgKGRlZmluaW5nUHJvcGVydHkgfHwgdGhpcyA9PT0gdGFyZ2V0LnByb3RvdHlwZSB8fCB0aGlzLmhhc093blByb3BlcnR5KGtleSkgfHwgdHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBmbjtcbiAgICAgIH1cblxuICAgICAgdmFyIGJvdW5kRm4gPSBmbi5iaW5kKHRoaXMpO1xuICAgICAgZGVmaW5pbmdQcm9wZXJ0eSA9IHRydWU7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywga2V5LCB7XG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIGJvdW5kRm47XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7XG4gICAgICAgICAgZm4gPSB2YWx1ZTtcbiAgICAgICAgICBkZWxldGUgdGhpc1trZXldO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGRlZmluaW5nUHJvcGVydHkgPSBmYWxzZTtcbiAgICAgIHJldHVybiBib3VuZEZuO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHtcbiAgICAgIGZuID0gdmFsdWU7XG4gICAgfVxuICB9O1xufVxuLyoqXG4gKiBVc2UgYm91bmRNZXRob2QgdG8gYmluZCBhbGwgbWV0aG9kcyBvbiB0aGUgdGFyZ2V0LnByb3RvdHlwZVxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBib3VuZENsYXNzKHRhcmdldCkge1xuICAvLyAoVXNpbmcgcmVmbGVjdCB0byBnZXQgYWxsIGtleXMgaW5jbHVkaW5nIHN5bWJvbHMpXG4gIHZhciBrZXlzOyAvLyBVc2UgUmVmbGVjdCBpZiBleGlzdHNcblxuICBpZiAodHlwZW9mIFJlZmxlY3QgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBSZWZsZWN0Lm93bktleXMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBrZXlzID0gUmVmbGVjdC5vd25LZXlzKHRhcmdldC5wcm90b3R5cGUpO1xuICB9IGVsc2Uge1xuICAgIGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0YXJnZXQucHJvdG90eXBlKTsgLy8gVXNlIHN5bWJvbHMgaWYgc3VwcG9ydCBpcyBwcm92aWRlZFxuXG4gICAgaWYgKHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBrZXlzID0ga2V5cy5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0YXJnZXQucHJvdG90eXBlKSk7XG4gICAgfVxuICB9XG5cbiAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAvLyBJZ25vcmUgc3BlY2lhbCBjYXNlIHRhcmdldCBtZXRob2RcbiAgICBpZiAoa2V5ID09PSAnY29uc3RydWN0b3InKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldC5wcm90b3R5cGUsIGtleSk7IC8vIE9ubHkgbWV0aG9kcyBuZWVkIGJpbmRpbmdcblxuICAgIGlmICh0eXBlb2YgZGVzY3JpcHRvci52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldC5wcm90b3R5cGUsIGtleSwgYm91bmRNZXRob2QodGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdGFyZ2V0O1xufVxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYXV0b2JpbmQoKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIGJvdW5kQ2xhc3MuYXBwbHkodm9pZCAwLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgcmV0dXJuIGJvdW5kTWV0aG9kLmFwcGx5KHZvaWQgMCwgYXJndW1lbnRzKTtcbn0iLCAiaW1wb3J0IHt1dWlkLCBkZWJvdW5jZX0gZnJvbSAnLi4vdG9vbCdcbmltcG9ydCBMb3ZlbHlNaW5kbWFwIGZyb20gJy4uL21haW4nXG5pbXBvcnQge0tleW1hcENvbnRleHR9IGZyb20gJ29ic2lkaWFuJ1xuaW1wb3J0IGF1dG9iaW5kIGZyb20gJ2F1dG9iaW5kLWRlY29yYXRvcidcblxuXG5AYXV0b2JpbmRcbmNsYXNzIE5vZGUge1xuICBtYWluOiBMb3ZlbHlNaW5kbWFwXG5cbiAgY29uc3RydWN0b3IobWFpbjogTG92ZWx5TWluZG1hcCkge1xuICAgIHRoaXMubWFpbiA9IG1haW5cbiAgfVxuXG4gIGdldE5hdmlnYXRpb25Ob2RlKCk6IE0uTm9kZSB8IG51bGwge1xuICAgIGNvbnN0IG5vZGUgPSB0aGlzLmdldFNpbmdsZVNlbGVjdGlvbigpXG4gICAgaWYgKCFub2RlIHx8ICFub2RlLmlzRm9jdXNlZCB8fCBub2RlLmlzRWRpdGluZykgcmV0dXJuIG51bGxcblxuICAgIHJldHVybiBub2RlXG4gIH1cblxuICBnZXRDcmVhdGlvbk5vZGUoKTogTS5Ob2RlIHwgbnVsbCB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuZ2V0U2luZ2xlU2VsZWN0aW9uKClcbiAgICBpZiAoIW5vZGUgfHwgIW5vZGUuaXNGb2N1c2VkIHx8ICFub2RlLmlzRWRpdGluZykgcmV0dXJuIG51bGxcblxuICAgIHJldHVybiBub2RlXG4gIH1cblxuICBnZXRTZWxlY3Rpb24oKTogU2V0PE0uTm9kZT4ge1xuICAgIHJldHVybiB0aGlzLm1haW4uY2FudmFzLnNlbGVjdGlvblxuICB9XG5cbiAgZ2V0U2luZ2xlU2VsZWN0aW9uKCk6IE0uTm9kZSB8IG51bGwge1xuICAgIGNvbnN0IHNlbGVjdGlvbnMgPSB0aGlzLm1haW4uY2FudmFzLnNlbGVjdGlvblxuXG4gICAgaWYgKHNlbGVjdGlvbnMuc2l6ZSA9PT0gMCB8fCBzZWxlY3Rpb25zLnNpemUgPiAxKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3Rpb25zLnZhbHVlcygpLm5leHQoKS52YWx1ZVxuICB9XG5cbiAgZ2V0RnJvbU5vZGVzKG5vZGU6IE0uTm9kZSkge1xuICAgIGNvbnN0IGZyb21Ob2RlRmlsdGVyID0gKGVkZ2U6IE0uRWRnZSkgPT4gZWRnZS50by5ub2RlLmlkID09PSBub2RlLmlkXG5cbiAgICByZXR1cm4gdGhpcy5tYWluLmNhbnZhc1xuICAgICAgLmdldEVkZ2VzRm9yTm9kZShub2RlKVxuICAgICAgLmZpbHRlcihmcm9tTm9kZUZpbHRlcilcbiAgICAgIC5tYXAoKGVkZ2U6IE0uRWRnZSkgPT4gZWRnZS5mcm9tLm5vZGUpXG4gIH1cblxuICBnZXRUb05vZGVzKG5vZGU6IE0uTm9kZSkge1xuICAgIGNvbnN0IHRvTm9kZUZpbHRlciA9IChlZGdlOiBNLkVkZ2UpID0+IGVkZ2UuZnJvbS5ub2RlLmlkID09PSBub2RlLmlkXG5cbiAgICByZXR1cm4gdGhpcy5tYWluLmNhbnZhc1xuICAgICAgLmdldEVkZ2VzRm9yTm9kZShub2RlKVxuICAgICAgLmZpbHRlcih0b05vZGVGaWx0ZXIpXG4gICAgICAubWFwKChlZGdlOiBNLkVkZ2UpID0+IGVkZ2UudG8ubm9kZSlcbiAgfVxuXG4gIGdldFNpYk5vZGVzKHRhcmdldDogTS5Ob2RlKSB7XG4gICAgY29uc3QgZnJvbU5vZGVzID0gdGhpcy5nZXRGcm9tTm9kZXModGFyZ2V0KVxuICAgIGNvbnN0IHRvTm9kZXMgPSB0aGlzLmdldFRvTm9kZXMoZnJvbU5vZGVzWzBdKVxuICAgIHJldHVybiB0b05vZGVzLmZpbHRlcigobm9kZTogTS5Ob2RlKSA9PiBub2RlLmlkICE9PSB0YXJnZXQuaWQpXG4gIH1cblxuICBAZGVib3VuY2UoKVxuICBjcmVhdGVDaGlsZHJlbigpIHtcbiAgICBjb25zdCBzZWxlY3Rpb24gPSB0aGlzLmdldE5hdmlnYXRpb25Ob2RlKClcbiAgICBpZiAoIXNlbGVjdGlvbikgcmV0dXJuXG5cbiAgICBjb25zdCB7XG4gICAgICB4LFxuICAgICAgeSxcbiAgICAgIHdpZHRoLFxuICAgICAgaGVpZ2h0LFxuICAgIH0gPSBzZWxlY3Rpb25cblxuICAgIC8vIG5vZGUgd2l0aCBmcm9tIGFuZCB0byBhdHRycyB3ZSBjYWxsZWQgYEVkZ2VgXG4gICAgLy8gbm9kZSB3aXRob3V0IGZyb20gYW5kIHRvIGJ1dCBoYXMgeCx5LHdpZHRoLGhlaWdodCBhdHRycyB3ZSBjYWxsZWQgYE5vZGVgXG4gICAgY29uc3QgcmlnaHRTaWRlTm9kZUZpbHRlciA9IChub2RlOiBNLkVkZ2UpID0+IG5vZGU/LnRvPy5zaWRlID09PSAnbGVmdCcgJiYgc2VsZWN0aW9uLmlkICE9PSBub2RlPy50bz8ubm9kZT8uaWRcblxuICAgIGNvbnN0IHNpYk5vZGVzID0gdGhpcy5tYWluLmNhbnZhc1xuICAgICAgLmdldEVkZ2VzRm9yTm9kZShzZWxlY3Rpb24pXG4gICAgICAuZmlsdGVyKHJpZ2h0U2lkZU5vZGVGaWx0ZXIpXG4gICAgICAubWFwKChub2RlOiBNLkVkZ2UpID0+IG5vZGUudG8ubm9kZSlcblxuICAgIGNvbnN0IG5leHROb2RlWSA9IE1hdGgubWF4KC4uLnNpYk5vZGVzLm1hcCgobm9kZTogTS5Ob2RlKSA9PiBub2RlLnkpKSArIHRoaXMubWFpbi5zZXR0aW5nLkVQU0lMT05cblxuICAgIGNvbnN0IGNoaWxkTm9kZSA9IHRoaXMubWFpbi5jYW52YXMuY3JlYXRlVGV4dE5vZGUoe1xuICAgICAgcG9zOiB7XG4gICAgICAgIHg6IHggKyB3aWR0aCArIDIwMCxcbiAgICAgICAgeTogbmV4dE5vZGVZLFxuICAgICAgfSxcbiAgICAgIHNpemU6IHtcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHdpZHRoOiB3aWR0aFxuICAgICAgfSxcbiAgICAgIHRleHQ6ICcnLFxuICAgICAgZm9jdXM6IGZhbHNlLFxuICAgICAgc2F2ZTogdHJ1ZSxcbiAgICB9KVxuXG4gICAgY29uc3QgZGF0YSA9IHRoaXMubWFpbi5jYW52YXMuZ2V0RGF0YSgpXG5cbiAgICB0aGlzLm1haW4uY2FudmFzLmltcG9ydERhdGEoe1xuICAgICAgJ2VkZ2VzJzogW1xuICAgICAgICAuLi5kYXRhLmVkZ2VzLFxuICAgICAgICB7XG4gICAgICAgICAgJ2lkJzogdXVpZCgpLFxuICAgICAgICAgICdmcm9tTm9kZSc6IHNlbGVjdGlvbi5pZCxcbiAgICAgICAgICAnZnJvbVNpZGUnOiAncmlnaHQnLFxuICAgICAgICAgICd0b05vZGUnOiBjaGlsZE5vZGUuaWQsXG4gICAgICAgICAgJ3RvU2lkZSc6ICdsZWZ0JyxcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgICdub2Rlcyc6IGRhdGEubm9kZXMsXG4gICAgfSlcblxuICAgIHRoaXMubWFpbi5sYXlvdXQudXNlU2lkZShzZWxlY3Rpb24sIHNpYk5vZGVzLmNvbmNhdChjaGlsZE5vZGUpKVxuXG4gICAgdGhpcy5tYWluLnZpZXcuem9vbVRvTm9kZShjaGlsZE5vZGUpXG4gIH1cblxuICBAZGVib3VuY2UoKVxuICBjcmVhdGVTaWJOb2RlKF86IHVua25vd24sIGNvbnRleHQ6IEtleW1hcENvbnRleHQpIHtcbiAgICBjb25zdCBzZWxlY3Rpb24gPSB0aGlzLmdldE5hdmlnYXRpb25Ob2RlKClcbiAgICBpZiAoIXNlbGVjdGlvbikgcmV0dXJuXG5cbiAgICBjb25zdCB7XG4gICAgICB4LFxuICAgICAgeSxcbiAgICAgIHdpZHRoLFxuICAgICAgaGVpZ2h0LFxuICAgIH0gPSBzZWxlY3Rpb25cbiAgICBjb25zdCB7IEVQU0lMT04gfSA9IHRoaXMubWFpbi5zZXR0aW5nXG5cbiAgICBjb25zdCBpc1ByZXNzZWRTaGlmdCA9IGNvbnRleHQubW9kaWZpZXJzID09PSAnU2hpZnQnXG5cbiAgICBjb25zdCBmcm9tTm9kZSA9IHRoaXMubWFpbi5ub2RlLmdldEZyb21Ob2RlcyhzZWxlY3Rpb24pWzBdXG4gICAgY29uc3QgdG9Ob2RlcyA9IHRoaXMubWFpbi5ub2RlLmdldFRvTm9kZXMoZnJvbU5vZGUpXG5cbiAgICBjb25zdCB3aWxsSW5zZXJ0ZWROb2RlID0gdGhpcy5tYWluLmNhbnZhcy5jcmVhdGVUZXh0Tm9kZSh7XG4gICAgICBwb3M6IHtcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogaXNQcmVzc2VkU2hpZnQgPyB5IC0gRVBTSUxPTiA6IHkgKyBFUFNJTE9OLFxuICAgICAgfSxcbiAgICAgIHNpemU6IHtcbiAgICAgICAgaGVpZ2h0LFxuICAgICAgICB3aWR0aCxcbiAgICAgIH0sXG4gICAgICB0ZXh0OiAnJyxcbiAgICAgIGZvY3VzOiBmYWxzZSxcbiAgICAgIHNhdmU6IHRydWUsXG4gICAgfSlcblxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1haW4uY2FudmFzLmdldERhdGEoKVxuXG4gICAgdGhpcy5tYWluLmNhbnZhcy5pbXBvcnREYXRhKHtcbiAgICAgICdlZGdlcyc6IFtcbiAgICAgICAgLi4uZGF0YS5lZGdlcyxcbiAgICAgICAge1xuICAgICAgICAgICdpZCc6IHV1aWQoKSxcbiAgICAgICAgICAnZnJvbU5vZGUnOiBmcm9tTm9kZS5pZCxcbiAgICAgICAgICAnZnJvbVNpZGUnOiAncmlnaHQnLFxuICAgICAgICAgICd0b05vZGUnOiB3aWxsSW5zZXJ0ZWROb2RlLmlkLFxuICAgICAgICAgICd0b1NpZGUnOiAnbGVmdCcsXG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgICAnbm9kZXMnOiBkYXRhLm5vZGVzLFxuICAgIH0pXG5cblxuICAgIHRoaXMubWFpbi5sYXlvdXQudXNlU2lkZShmcm9tTm9kZSwgdG9Ob2Rlcy5jb25jYXQod2lsbEluc2VydGVkTm9kZSkpXG4gICAgdGhpcy5tYWluLnZpZXcuem9vbVRvTm9kZSh3aWxsSW5zZXJ0ZWROb2RlKVxuICB9XG59XG5cbmV4cG9ydCB7IE5vZGUgfVxuIiwgImltcG9ydCB7S2V5bWFwQ29udGV4dCwgS2V5bWFwRXZlbnRIYW5kbGVyLCBLZXltYXBFdmVudExpc3RlbmVyLCBNb2RpZmllcn0gZnJvbSAnb2JzaWRpYW4nXG5pbXBvcnQge05vZGV9IGZyb20gJy4vbm9kZSdcbmltcG9ydCBMb3ZlbHlNaW5kbWFwIGZyb20gJy4uL21haW4nXG5pbXBvcnQgYXV0b2JpbmQgZnJvbSAnYXV0b2JpbmQtZGVjb3JhdG9yJ1xuaW1wb3J0IHtkZWJvdW5jZX0gZnJvbSAnLi4vdG9vbCdcblxuXG4vKipcbiAqIFJlZ2lzdGVyIGFuZCBtYW5hZ2UgeW91ciBrZXltYXBcbiAqL1xuQGF1dG9iaW5kXG5jbGFzcyBLZXltYXAge1xuICBob3RrZXlzOiBLZXltYXBFdmVudEhhbmRsZXJbXSA9IFtdXG4gIG1haW46IExvdmVseU1pbmRtYXBcbiAgbm9kZTogTm9kZVxuXG4gIGNvbnN0cnVjdG9yKG1haW46IExvdmVseU1pbmRtYXApIHtcbiAgICB0aGlzLm1haW4gPSBtYWluXG4gICAgdGhpcy5ub2RlID0gbWFpbi5ub2RlXG4gIH1cblxuICBAZGVib3VuY2UoKVxuICBhc3luYyBoZWxwKCkge1xuICAgIGlmICh0aGlzLm1haW4udmlldy5pc0NyZWF0aW5nKCkpIHJldHVyblxuXG4gICAgY29uc29sZS5sb2coJ3RoaXM6XFxuJywgdGhpcylcbiAgICBjb25zb2xlLmxvZygnYXBwOlxcbicsIHRoaXMubWFpbi5hcHApXG4gICAgY29uc29sZS5sb2coJ2NhbnZhczpcXG4nLCB0aGlzLm1haW4uY2FudmFzKVxuICAgIGNvbnNvbGUubG9nKCdzZWxlY3Rpb25zOlxcbicsIHRoaXMubWFpbi5jYW52YXMuc2VsZWN0aW9uLnZhbHVlcygpLm5leHQoKSlcbiAgfVxuXG4gIG5vZGVOYXZpZ2F0aW9uKF86IHVua25vd24sIGNvbnRleHQ6IEtleW1hcENvbnRleHQpIHtcbiAgICB0eXBlIEtleSA9ICdBcnJvd1VwJyB8ICdBcnJvd0Rvd24nIHwgJ0Fycm93TGVmdCcgfCAnQXJyb3dSaWdodCdcbiAgICBjb25zdCB7a2V5fSA9IGNvbnRleHQgYXMgT21pdDxLZXltYXBDb250ZXh0LCAna2V5Jz4gJiB7IGtleTogS2V5IH1cblxuICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMubm9kZS5nZXRTaW5nbGVTZWxlY3Rpb24oKVxuICAgIGlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5pc0VkaXRpbmcpIHtcbiAgICAgIC8vIGNvbnN0IG5vdGljZSA9IG5ldyBOb3RpY2UoJycpXG4gICAgICAvLyBub3RpY2Uuc2V0TWVzc2FnZSgnUHJlc3MgYGNtZCArIEVzY2AgdG8gZXhpdCBjcmVhdGluZyB2aWV3JylcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBjb25zdCB7T0ZGU0VUX1dFSUdIVH0gPSB0aGlzLm1haW4uc2V0dGluZ1xuXG4gICAgY29uc3QgZGF0YSA9IHRoaXMubWFpbi5jYW52YXMuZ2V0Vmlld3BvcnROb2RlcygpXG5cblxuICAgIGNvbnN0IG9mZnNldFggPSAoYTogTS5Ob2RlLCBiOiBNLk5vZGUpID0+IE1hdGguYWJzKGIueCAtIGEueClcbiAgICBjb25zdCBvZmZzZXRZID0gKGE6IE0uTm9kZSwgYjogTS5Ob2RlKSA9PiBNYXRoLmFicyhiLnkgLSBhLnkpXG4gICAgLy8gZml4ZWQ6IFx1NTkwRFx1NjU3MFx1NzY4NFx1OTc1RVx1NjU3NFx1NkIyMVx1NjVCOVx1NEUzQSBOYU5cbiAgICAvLyBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL01hdGgvcG93I3JldHVybl92YWx1ZTp+OnRleHQ9YmFzZSUyMCUzQyUyMDAlMjBhbmQlMjBleHBvbmVudCUyMGlzJTIwbm90JTIwYW4lMjBpbnRlZ2VyLlxuICAgIGNvbnN0IGVuZHBvaW50T2Zmc2V0ID0gKGE6IE0uTm9kZSwgYjogTS5Ob2RlKSA9PiBNYXRoLm1pbihcbiAgICAgIE1hdGguYWJzKGIueSAtIGEueSArIDIgLyBhLmhlaWdodCksXG4gICAgICBNYXRoLmFicyhiLnkgKyBiLmhlaWdodCAtIGEueSAtIDIgLyBhLmhlaWdodCksXG4gICAgICBNYXRoLmFicyhiLnggLSBhLnggKyAyIC8gYS53aWR0aCksXG4gICAgICBNYXRoLmFicyhiLnggKyBiLndpZHRoIC0gYS54ICsgMiAvIGEud2lkdGgpLFxuICAgIClcbiAgICBjb25zdCBjYWxjRGlzdGFuY2UgPSAoYTogTS5Ob2RlLCBiOiBNLk5vZGUpID0+IChrZXkgPT09ICdBcnJvd0xlZnQnIHx8IGtleSA9PT0gJ0Fycm93UmlnaHQnKVxuICAgICAgPyBvZmZzZXRYKGEsIGIpICsgZW5kcG9pbnRPZmZzZXQoYSwgYikgKiogT0ZGU0VUX1dFSUdIVFxuICAgICAgOiBvZmZzZXRZKGEsIGIpICsgZW5kcG9pbnRPZmZzZXQoYSwgYikgKiogT0ZGU0VUX1dFSUdIVFxuICAgIGNvbnN0IGlzU2FtZURpcmVjdGlvbiA9IChub2RlOiBNLk5vZGUpID0+IHtcbiAgICAgIGNvbnN0IG5vdFNlbGYgPSBub2RlLmlkICE9PSBzZWxlY3Rpb24uaWRcbiAgICAgIGNvbnN0IHN0cmF0ZWdpZXMgPSB7XG4gICAgICAgIEFycm93UmlnaHQ6IG5vdFNlbGYgJiYgbm9kZS54ID4gc2VsZWN0aW9uLnggKyBzZWxlY3Rpb24ud2lkdGgsXG4gICAgICAgIEFycm93TGVmdDogbm90U2VsZiAmJiBub2RlLnggKyBub2RlLndpZHRoIDwgc2VsZWN0aW9uLngsXG4gICAgICAgIEFycm93VXA6IG5vdFNlbGYgJiYgbm9kZS55ICsgbm9kZS5oZWlnaHQgPCBzZWxlY3Rpb24ueSxcbiAgICAgICAgQXJyb3dEb3duOiBub3RTZWxmICYmIG5vZGUueSA+IHNlbGVjdGlvbi55ICsgc2VsZWN0aW9uLmhlaWdodCxcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdHJhdGVnaWVzW2tleV1cbiAgICB9XG5cbiAgICBjb25zdCBtaWRwb2ludHMgPSBkYXRhXG4gICAgICAuZmlsdGVyKGlzU2FtZURpcmVjdGlvbilcbiAgICAgIC5tYXAoKG5vZGU6IE0uTm9kZSkgPT4gKHtcbiAgICAgICAgbm9kZSxcbiAgICAgICAgb2Zmc2V0WDogb2Zmc2V0WChzZWxlY3Rpb24sIG5vZGUpLFxuICAgICAgICBvZmZzZXRZOiBvZmZzZXRZKHNlbGVjdGlvbiwgbm9kZSksXG4gICAgICAgIGVuZHBvaW50T2Zmc2V0OiBlbmRwb2ludE9mZnNldChzZWxlY3Rpb24sIG5vZGUpLFxuICAgICAgICBkaXN0YW5jZTogY2FsY0Rpc3RhbmNlKHNlbGVjdGlvbiwgbm9kZSlcbiAgICAgIH0pKVxuICAgICAgLnNvcnQoKGE6IE0uTm9kZSwgYjogTS5Ob2RlKSA9PiBhLmRpc3RhbmNlIC0gYi5kaXN0YW5jZSlcblxuICAgIGlmIChtaWRwb2ludHMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5tYWluLnZpZXcuem9vbVRvTm9kZShtaWRwb2ludHNbMF0ubm9kZSlcbiAgICB9XG4gIH1cblxuICBibHVyTm9kZSgpIHtcbiAgICBpZiAodGhpcy5tYWluLnZpZXcuaXNDcmVhdGluZygpKSB7XG4gICAgICB0aGlzLm1haW4udmlldy5jcmVhdGlvbjJOYXZpZ2F0aW9uKClcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGlmICh0aGlzLm1haW4udmlldy5pc05hdmlnYXRpbmcoKSkge1xuICAgICAgdGhpcy5tYWluLnZpZXcudXNlVG91Y2goKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICB9XG5cblxuICBmb2N1c05vZGUoKSB7XG4gICAgaWYgKHRoaXMubWFpbi52aWV3LmlzVG91Y2hpbmcoKSkge1xuICAgICAgdGhpcy5tYWluLnZpZXcudG91Y2gyTmF2aWdhdGlvbigpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBuYXZpZ2F0aW9uTm9kZSA9IHRoaXMubWFpbi5ub2RlLmdldE5hdmlnYXRpb25Ob2RlKClcbiAgICBpZiAoISFuYXZpZ2F0aW9uTm9kZSkge1xuICAgICAgdGhpcy5tYWluLnZpZXcudXNlQ3JlYXRpb24obmF2aWdhdGlvbk5vZGUpXG4gICAgICByZXR1cm5cbiAgICB9XG4gIH1cblxuICByZWdpc3RlcihcbiAgICBtb2RpZmllcnM6IE1vZGlmaWVyW10sXG4gICAga2V5OiBzdHJpbmcgfCBudWxsLFxuICAgIGZ1bmM6IEtleW1hcEV2ZW50TGlzdGVuZXJcbiAgKTogS2V5bWFwRXZlbnRIYW5kbGVyIHtcbiAgICByZXR1cm4gdGhpcy5tYWluLmFwcC5zY29wZS5yZWdpc3Rlcihtb2RpZmllcnMsIGtleSwgZnVuYylcbiAgfVxuXG4gIHJlZ2lzdGVyQWxsKCkge1xuICAgIHRoaXMuaG90a2V5cy5wdXNoKFxuICAgICAgdGhpcy5yZWdpc3RlcihbXSwgJ2YnLCB0aGlzLmZvY3VzTm9kZSksXG4gICAgICB0aGlzLnJlZ2lzdGVyKFsnTWV0YSddLCAnRXNjYXBlJywgdGhpcy5ibHVyTm9kZSksXG4gICAgICB0aGlzLnJlZ2lzdGVyKFtdLCAnVGFiJywgdGhpcy5tYWluLm5vZGUuY3JlYXRlQ2hpbGRyZW4pLFxuICAgICAgdGhpcy5yZWdpc3RlcihbXSwgJ2VudGVyJywgdGhpcy5tYWluLm5vZGUuY3JlYXRlU2liTm9kZSksXG4gICAgICB0aGlzLnJlZ2lzdGVyKFsnU2hpZnQnXSwgJ2VudGVyJywgdGhpcy5tYWluLm5vZGUuY3JlYXRlU2liTm9kZSksXG4gICAgICB0aGlzLnJlZ2lzdGVyKFsnQWx0J10sICdhcnJvd0xlZnQnLCB0aGlzLm5vZGVOYXZpZ2F0aW9uKSxcbiAgICAgIHRoaXMucmVnaXN0ZXIoWydBbHQnXSwgJ2Fycm93UmlnaHQnLCB0aGlzLm5vZGVOYXZpZ2F0aW9uKSxcbiAgICAgIHRoaXMucmVnaXN0ZXIoWydBbHQnXSwgJ2Fycm93VXAnLCB0aGlzLm5vZGVOYXZpZ2F0aW9uKSxcbiAgICAgIHRoaXMucmVnaXN0ZXIoWydBbHQnXSwgJ2Fycm93RG93bicsIHRoaXMubm9kZU5hdmlnYXRpb24pLFxuICAgICAgLy8gdGhpcy5yZWdpc3RlcihbXSwgJ2gnLCB0aGlzLmhlbHApXG4gICAgKVxuICB9XG5cbiAgdW5yZWdpc3RlckFsbCgpIHtcbiAgICB0aGlzLmhvdGtleXMuZm9yRWFjaChrZXkgPT4gdGhpcy5tYWluLmFwcC5zY29wZS51bnJlZ2lzdGVyKGtleSkpXG4gIH1cbn1cblxuZXhwb3J0IHtLZXltYXB9XG4iLCAiaW1wb3J0IExvdmVseU1pbmRtYXAgZnJvbSAnLi4vbWFpbidcbmltcG9ydCB7ZmluZENsb3Nlc3ROb2RlQnlCYm94fSBmcm9tICcuLi90b29sJ1xuXG4vKipcbiAqIEEgZnJpZW5kbHkgd2F5IHRvIG1hbmFnZSB5b3VyIGF0dGVudGlvblxuICogVGhyZWUgd2F5cyB0byBpbnRlcmFjdGlvblxuICogIC0gVG91Y2hcbiAqICAtIE5hdmlnYXRpb25cbiAqICAtIENyZWF0aW9uXG4gKlxuICovXG5jbGFzcyBWaWV3IHtcbiAgbWFpbjogTG92ZWx5TWluZG1hcFxuXG4gIGNvbnN0cnVjdG9yKG1haW46IExvdmVseU1pbmRtYXApIHtcbiAgICB0aGlzLm1haW4gPSBtYWluXG4gIH1cblxuICBpc1RvdWNoaW5nKCkge1xuICAgIHJldHVybiB0aGlzLm1haW4ubm9kZS5nZXRTZWxlY3Rpb24oKS5zaXplID09PSAwXG4gIH1cblxuICBpc05hdmlnYXRpbmcoKSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMubWFpbi5ub2RlLmdldFNpbmdsZVNlbGVjdGlvbigpXG4gICAgaWYgKCFub2RlKSByZXR1cm4gZmFsc2VcblxuICAgIHJldHVybiBub2RlLmlzRm9jdXNlZCAmJiAhbm9kZS5pc0VkaXRpbmdcbiAgfVxuXG4gIGlzQ3JlYXRpbmcoKSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMubWFpbi5ub2RlLmdldFNpbmdsZVNlbGVjdGlvbigpXG4gICAgaWYgKCFub2RlKSByZXR1cm4gZmFsc2VcblxuICAgIHJldHVybiBub2RlLmlzRm9jdXNlZCAmJiBub2RlLmlzRWRpdGluZ1xuICB9XG5cbiAgdXNlVG91Y2goKSB7XG4gICAgdGhpcy5tYWluLmNhbnZhcy5kZXNlbGVjdEFsbCgpXG4gIH1cblxuICB1c2VDcmVhdGlvbihub2RlOiBNLk5vZGUpIHtcbiAgICBzZXRUaW1lb3V0KFxuICAgICAgKCkgPT4gbm9kZS5zdGFydEVkaXRpbmcoKSxcbiAgICAgIHRoaXMubWFpbi5zZXR0aW5nLk1BQ1JPX1RBU0tfREVMQVlcbiAgICApXG4gIH1cblxuICBjcmVhdGlvbjJOYXZpZ2F0aW9uKCkge1xuICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMubWFpbi5ub2RlLmdldFNpbmdsZVNlbGVjdGlvbigpXG4gICAgaWYgKCFzZWxlY3Rpb24gfHwgIXRoaXMuaXNDcmVhdGluZygpKSByZXR1cm5cblxuICAgIHNlbGVjdGlvbi5ibHVyKClcbiAgICAvLyBtYWdpYzogYmx1ciB3aWxsIGxvc2Ugc2VsZWN0aW9uIHN0eWxlXG4gICAgc2VsZWN0aW9uLmZvY3VzKClcbiAgfVxuXG4gIHRvdWNoMk5hdmlnYXRpb24oKSB7XG4gICAgY29uc3Qgdmlld3BvcnRCQm94ID0gdGhpcy5tYWluLmNhbnZhcy5nZXRWaWV3cG9ydEJCb3goKVxuICAgIGNvbnN0IGNlbnRlclBvaW50OiBNLlBvc2l0aW9uID0gW1xuICAgICAgKHZpZXdwb3J0QkJveC5taW5YICsgdmlld3BvcnRCQm94Lm1heFgpIC8gMixcbiAgICAgICh2aWV3cG9ydEJCb3gubWluWSArIHZpZXdwb3J0QkJveC5tYXhZKSAvIDIsXG4gICAgXVxuXG4gICAgY29uc3Qgdmlld3BvcnROb2RlcyA9IHRoaXMubWFpbi5jYW52YXMuZ2V0Vmlld3BvcnROb2RlcygpXG4gICAgY29uc3QgcmVzID0gZmluZENsb3Nlc3ROb2RlQnlCYm94KGNlbnRlclBvaW50LCB2aWV3cG9ydE5vZGVzKVxuICAgIHRoaXMuem9vbVRvTm9kZShyZXMubm9kZSlcbiAgfVxuXG4gIHpvb21Ub05vZGUobm9kZTogTS5Ob2RlKSB7XG4gICAgdGhpcy5tYWluLmNhbnZhcy5zZWxlY3RPbmx5KG5vZGUpXG4gICAgdGhpcy5tYWluLmNhbnZhcy56b29tVG9TZWxlY3Rpb24oKVxuXG4gICAgaWYgKHRoaXMubWFpbi5jb25maWcuYXV0b0ZvY3VzKSB7XG4gICAgICB0aGlzLnVzZUNyZWF0aW9uKG5vZGUpXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7Vmlld31cbiIsICJpbXBvcnQge1BsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgYXMgT2JzaWRpYW5TZXR0aW5nfSBmcm9tICdvYnNpZGlhbidcbmltcG9ydCBMb3ZlbHlNaW5kbWFwIGZyb20gJy4uL21haW4nXG5cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUyA9IHtcbiAgYXV0b0ZvY3VzOiBmYWxzZVxufVxuXG5jbGFzcyBTZXR0aW5nIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIG1haW46IExvdmVseU1pbmRtYXBcblxuICBST1dfR0FQID0gMjBcbiAgQ09MVU1OX0dBUCA9IDIwMFxuICBhdXRvRm9jdXMgPSBmYWxzZVxuXG4gIHJlYWRvbmx5IE1BQ1JPX1RBU0tfREVMQVkgPSA1MFxuICByZWFkb25seSBFUFNJTE9OID0gMVxuICByZWFkb25seSBPRkZTRVRfV0VJR0hUID0gMS4xXG5cbiAgY29uc3RydWN0b3IobWFpbjogTG92ZWx5TWluZG1hcCkge1xuICAgIHN1cGVyKG1haW4uYXBwLCBtYWluKVxuICAgIHRoaXMubWFpbiA9IG1haW5cbiAgICBjb25zb2xlLmxvZygnc2V0dGluZycpXG4gIH1cblxuICBkaXNwbGF5KCkge1xuICAgIGNvbnN0IHtjb250YWluZXJFbH0gPSB0aGlzXG5cbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHt0ZXh0OiAnXHVEODNEXHVERUE3XHVEODNEXHVERUE3XHVEODNEXHVERUE3J30pXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywge3RleHQ6ICdUaGUgcGFnZSBpcyB1bmRlciBkZXZlbG9wbWVudCd9KVxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHt0ZXh0OiAnTW9zdCBzZXR0aW5ncyBhcmUgb3V0LW9mLXRoZS1ib3gnfSlcbiAgICB0aGlzLmFkZEF1dG9Gb2N1cygpXG4gIH1cblxuICBhZGRBdXRvRm9jdXMoKSB7XG4gICAgbmV3IE9ic2lkaWFuU2V0dGluZyh0aGlzLmNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ2F1dG9Gb2N1cycpXG4gICAgICAuc2V0RGVzYygnYXV0byBmb2N1cyBub2RlIHdoZW4gY3JlYXRlIG5ldyBub2RlJylcbiAgICAgIC5hZGRUb2dnbGUoY29tcG9uZW50ID0+IGNvbXBvbmVudFxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLm1haW4uY29uZmlnLmF1dG9Gb2N1cylcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKG9wZW4pID0+IHtcbiAgICAgICAgICAgIHRoaXMubWFpbi5jb25maWcuYXV0b0ZvY3VzID0gb3BlblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5tYWluLnNhdmVEYXRhKHRoaXMubWFpbi5jb25maWcpXG4gICAgICAgICAgfSlcbiAgICAgIClcbiAgfVxuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLm1haW4uY29uZmlnID0geyAuLi5ERUZBVUxUX1NFVFRJTkdTLCAuLi5hd2FpdCB0aGlzLm1haW4ubG9hZERhdGEoKX1cbiAgfVxufVxuXG5leHBvcnQgeyBTZXR0aW5nIH1cbiIsICJpbXBvcnQgTG92ZWx5TWluZG1hcCBmcm9tICcuLi9tYWluJ1xuXG4vKipcbiAqIFNpbWlsYXIgdG8gTm9kZSBtb2R1bGUsIGJ1dCB3aXRoIG11bHRpcGxlIG5vZGVzLCBhdCBsZWFzdCB0d29cbiAqL1xuY2xhc3MgTGF5b3V0IHtcbiAgbWFpbjogTG92ZWx5TWluZG1hcFxuXG4gIGNvbnN0cnVjdG9yKG1haW46IExvdmVseU1pbmRtYXApIHtcbiAgICB0aGlzLm1haW4gPSBtYWluXG4gIH1cblxuICB1c2VTaWRlKHBhcmVudDogTS5Ob2RlLCBjaGlsZDogTS5Ob2RlW10pIHtcbiAgICBjb25zdCB7IFJPV19HQVAsIENPTFVNTl9HQVAgfSA9IHRoaXMubWFpbi5zZXR0aW5nXG5cbiAgICBjb25zdCBiYm94ID0gY2hpbGQucmVkdWNlKChwcmV2LCBub2RlLCBpZHgpID0+IHtcbiAgICAgIHJldHVybiBpZHggPiAwXG4gICAgICAgID8ge1xuICAgICAgICAgIGhlaWdodDogcHJldi5oZWlnaHQgKyBub2RlLmhlaWdodCArIFJPV19HQVAsXG4gICAgICAgICAgaGVpZ2h0Tm9kZXM6IHByZXYuaGVpZ2h0Tm9kZXMuY29uY2F0KG5vZGUuaGVpZ2h0KSxcbiAgICAgICAgfVxuICAgICAgICA6IHtcbiAgICAgICAgICBoZWlnaHQ6IHByZXYuaGVpZ2h0ICsgbm9kZS5oZWlnaHQsXG4gICAgICAgICAgaGVpZ2h0Tm9kZXM6IHByZXYuaGVpZ2h0Tm9kZXMuY29uY2F0KG5vZGUuaGVpZ2h0KSxcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgIGhlaWdodDogMCxcbiAgICAgIGhlaWdodE5vZGVzOiBbXSBhcyBudW1iZXJbXSxcbiAgICB9KVxuXG4gICAgY29uc3QgdG9wID0gcGFyZW50LnkgKyBwYXJlbnQuaGVpZ2h0ICogMC41IC0gYmJveC5oZWlnaHQgKiAwLjVcblxuICAgIGNvbnN0IGdldFN1bSA9IChhcnI6IG51bWJlcltdKSA9PiBhcnIucmVkdWNlKChzdW0sIGN1cikgPT4gc3VtICsgY3VyLCAwKVxuXG4gICAgY2hpbGQuc29ydCgoYSwgYikgPT4gYS55IC0gYi55KS5mb3JFYWNoKChub2RlLCBpKSA9PiB7XG4gICAgICBub2RlLm1vdmVUbyh7XG4gICAgICAgIHg6IHBhcmVudC53aWR0aCArIHBhcmVudC54ICsgQ09MVU1OX0dBUCxcbiAgICAgICAgeTogdG9wICsgUk9XX0dBUCAqIGkgKyBnZXRTdW0oYmJveC5oZWlnaHROb2Rlcy5zbGljZSgwLCBpKSlcbiAgICAgIH0pXG4gICAgfSk7XG4gIH1cblxuICB1c2VTdXJyb3VuZCgpIHtcbiAgICAvLyBUT0RPXG4gIH1cbn1cblxuZXhwb3J0IHsgTGF5b3V0IH1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBeUY7OztBQ0F6RixTQUFTLFNBQVMsUUFBZ0IsS0FBc0I7QUFDdEQsTUFBSSxXQUFXO0FBQ2YsTUFBSTtBQUVKLFNBQU8sU0FBVSxRQUFhLGFBQXFCLFlBQWdDO0FBQ2pGLFVBQU0saUJBQWlCLFdBQVc7QUFFbEMsZUFBVyxRQUFRLFlBQWEsTUFBYTtBQUMzQyxZQUFNLE1BQU0sS0FBSyxJQUFJO0FBQ3JCLG1CQUFhLEtBQUs7QUFFbEIsVUFBSyxNQUFNLFdBQVksT0FBTztBQUM1QjtBQUFBLE1BQ0Y7QUFFQSxjQUFRLFdBQVcsTUFBTTtBQUN2Qix1QkFBZSxNQUFNLE1BQU0sSUFBSTtBQUMvQixtQkFBVztBQUFBLE1BQ2IsR0FBRyxLQUFLO0FBRVIsaUJBQVc7QUFBQSxJQUNiO0FBRUEsV0FBTztBQUFBLEVBQ1Q7QUFDRjtBQUdBLFNBQVMsYUFBYSxHQUFlLEdBQWU7QUFDbEQsU0FBTyxLQUFLO0FBQUEsS0FDVCxF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O0FBQ3JFLFVBQUksQ0FBQyxDQUFDLEtBQUssUUFBUTtBQUNqQixzQkFBYyxLQUFLLGNBQWMsSUFBSSxRQUFRLENBQUM7QUFBQSxNQUNoRDtBQUFBLElBQ0YsR0FBRyxHQUFJO0FBRVAsUUFBSSxDQUFDLEtBQUssY0FBYyxJQUFJLFFBQVEsR0FBRztBQUNyQyxXQUFLLGNBQWMsSUFBSSxVQUFVLEtBQUs7QUFBQSxJQUN4QztBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0sU0FBUztBQUNiLFVBQU0sS0FBSyxRQUFRLGFBQWE7QUFDaEMsU0FBSyxjQUFjLElBQUksUUFBUSxJQUFJLENBQUM7QUFDcEMsU0FBSyxPQUFPLFlBQVk7QUFDeEIsU0FBSyxxQkFBcUI7QUFBQSxFQUM1QjtBQUFBLEVBRUEsV0FBVztBQUNULFNBQUssT0FBTyxjQUFjO0FBQzFCLFNBQUssY0FBYyxRQUFRLGFBQWE7QUFBQSxFQUMxQztBQUNGOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfb2JzaWRpYW4iLCAiX3R5cGVvZiIsICJvYmoiLCAiZ2V0IiwgImNhbGNEaXN0YW5jZSIsICJPYnNpZGlhblNldHRpbmciLCAiYXBwIl0KfQo=
